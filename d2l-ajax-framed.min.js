(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var jwt=require("frau-jwt");Polymer({is:"d2l-ajax-framed",properties:{auto:{type:Boolean,value:false},url:{type:String},params:{type:Object,value:function(){return{}}},method:{type:String,value:"GET"},headers:{type:Object,value:function(){return{}}},contentType:{type:String,value:null},body:{type:Object,value:null},handleAs:{type:String,value:"json"},withCredentials:{type:Boolean,value:false},timeout:{type:Number,value:0},lastResponse:{type:Object,notify:true},lastError:{type:Object,notify:true},scope:{type:String,value:"*:*:*"},authToken:{type:String,value:function(){return null}}},observers:["_requestOptionsChanged(url, method, params.*, headers, contentType, "+"body, handleAs, withCredentials, timeout, auto)"],computeHeaders:function(headers,authToken){var result={},header;if(authToken){result.Authorization="Bearer "+authToken}if(headers instanceof Object){for(header in headers){result[header]=headers[header].toString()}}return result},generateRequest:function(){jwt(this.scope).then(function(token){this.authToken=token;this.$.request.generateRequest()}.bind(this)).catch(function(e){this.onError(e)})},onError:function(e){var data=e;if(e&&e.detail){data=e.detail}this.fire("iron-ajax-error",data)},onRequest:function(e){this.fire("iron-ajax-request",e.detail)},onResponse:function(e){this.fire("iron-ajax-response",e.detail)},_requestOptionsChanged:function(){if(this.url==null){return}if(this.auto){this.generateRequest()}}})},{"frau-jwt":32}],2:[function(require,module,exports){if(typeof module!=="undefined"){module.exports=Emitter}function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks["$"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks["$"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],3:[function(require,module,exports){"use strict";module.exports=function framed(){return!window.D2L||!window.D2L.LP}},{}],4:[function(require,module,exports){"use strict";var xsrfToken=require("frau-xsrf-token");var XSRF_HEADER="X-Csrf-Token";function noop(){}function isRelative(url){return typeof url==="string"&&url.length>0&&url[0]==="/"}module.exports=function getXsrfToken(req){var end=req.end;req.end=function getXsrfTokenEndOverride(cb){function completeRequest(){req.end=end;return req.end(cb)}if(!isRelative(req.url)){return completeRequest()}xsrfToken().then(function(token){req.set("X-Csrf-Token",token)}).catch(noop).then(function(){setTimeout(completeRequest)});return this};return req}},{"frau-xsrf-token":5}],5:[function(require,module,exports){"use strict";var Promise=require("lie");var requestToken=require("./request-token"),storage=require("./storage");module.exports=function getXsrfToken(){return Promise.resolve().then(storage.get).then(function(token){if(token){return token}return requestToken.get().then(storage.set)})}},{"./request-token":6,"./storage":7,lie:23}],6:[function(require,module,exports){"use strict";var Promise=require("lie"),request=require("superagent");var XSRF_TOKEN_PATH="/d2l/lp/auth/xsrf-tokens";function requestXsrfToken(){return new Promise(function(resolve,reject){request.get(XSRF_TOKEN_PATH).end(function(err,res){if(err){return reject(err)}return resolve(res.body.referrerToken)})})}module.exports.get=requestXsrfToken;module.exports.XSRF_TOKEN_PATH=XSRF_TOKEN_PATH},{lie:23,superagent:25}],7:[function(require,module,exports){(function(global){"use strict";var STORAGE_KEY="XSRF.Token";var fallback=null;function get(key){if(global.localStorage){try{return global.localStorage.getItem(key)}catch(e){}}return fallback}function set(key,value){if(global.localStorage){try{global.localStorage.setItem(key,value);return}catch(e){}}fallback=value}module.exports.get=function getWrapper(){return get(STORAGE_KEY)};module.exports.set=function setWrapper(value){set(STORAGE_KEY,value);return value};module.exports._resetFallback=function resetFallback(){fallback=null}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],8:[function(require,module,exports){(function(window,undefined){"use strict";var autoResize=true,base=10,bodyBackground="",bodyMargin=0,bodyMarginStr="",bodyObserver=null,bodyPadding="",calculateWidth=false,doubleEventList={resize:1,click:1},eventCancelTimer=128,firstRun=true,height=1,heightCalcModeDefault="bodyOffset",heightCalcMode=heightCalcModeDefault,initLock=true,initMsg="",inPageLinks={},interval=32,intervalTimer=null,logging=false,msgID="[iFrameSizer]",msgIdLen=msgID.length,myID="",observer=null,resetRequiredMethods={max:1,min:1,bodyScroll:1,documentElementScroll:1},resizeFrom="child",sendPermit=true,target=window.parent,targetOriginDefault="*",tolerance=0,triggerLocked=false,triggerLockedTimer=null,throttledTimer=16,width=1,widthCalcModeDefault="scroll",widthCalcMode=widthCalcModeDefault,win=window,messageCallback=function(){warn("MessageCallback function not defined")},readyCallback=function(){},pageInfoCallback=function(){},customCalcMethods={height:function(){warn("Custom height calculation function not defined");return document.documentElement.offsetHeight},width:function(){warn("Custom width calculation function not defined");return document.body.scrollWidth}};function addEventListener(el,evt,func){if("addEventListener"in window){el.addEventListener(evt,func,false)}else if("attachEvent"in window){el.attachEvent("on"+evt,func)}}function removeEventListener(el,evt,func){if("removeEventListener"in window){el.removeEventListener(evt,func,false)}else if("detachEvent"in window){el.detachEvent("on"+evt,func)}}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function throttle(func){var context,args,result,timeout=null,previous=0,later=function(){previous=getNow();timeout=null;result=func.apply(context,args);if(!timeout){context=args=null}};return function(){var now=getNow();if(!previous){previous=now}var remaining=throttledTimer-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>throttledTimer){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout){context=args=null}}else if(!timeout){timeout=setTimeout(later,remaining)}return result}}var getNow=Date.now||function(){return(new Date).getTime()};function formatLogMsg(msg){return msgID+"["+myID+"]"+" "+msg}function log(msg){if(logging&&"object"===typeof window.console){console.log(formatLogMsg(msg))}}function warn(msg){if("object"===typeof window.console){console.warn(formatLogMsg(msg))}}function init(){readDataFromParent();log("Initialising iFrame ("+location.href+")");readDataFromPage();setMargin();setBodyStyle("background",bodyBackground);setBodyStyle("padding",bodyPadding);injectClearFixIntoBodyElement();checkHeightMode();checkWidthMode();stopInfiniteResizingOfIFrame();setupPublicMethods();startEventListeners();inPageLinks=setupInPageLinks();sendSize("init","Init message from host page");readyCallback()}function readDataFromParent(){function strBool(str){return"true"===str?true:false}var data=initMsg.substr(msgIdLen).split(":");myID=data[0];bodyMargin=undefined!==data[1]?Number(data[1]):bodyMargin;calculateWidth=undefined!==data[2]?strBool(data[2]):calculateWidth;logging=undefined!==data[3]?strBool(data[3]):logging;interval=undefined!==data[4]?Number(data[4]):interval;autoResize=undefined!==data[6]?strBool(data[6]):autoResize;bodyMarginStr=data[7];heightCalcMode=undefined!==data[8]?data[8]:heightCalcMode;bodyBackground=data[9];bodyPadding=data[10];tolerance=undefined!==data[11]?Number(data[11]):tolerance;inPageLinks.enable=undefined!==data[12]?strBool(data[12]):false;resizeFrom=undefined!==data[13]?data[13]:resizeFrom;widthCalcMode=undefined!==data[14]?data[14]:widthCalcMode}function readDataFromPage(){function readData(){var data=window.iFrameResizer;log("Reading data from page: "+JSON.stringify(data));messageCallback="messageCallback"in data?data.messageCallback:messageCallback;readyCallback="readyCallback"in data?data.readyCallback:readyCallback;targetOriginDefault="targetOrigin"in data?data.targetOrigin:targetOriginDefault;heightCalcMode="heightCalculationMethod"in data?data.heightCalculationMethod:heightCalcMode;widthCalcMode="widthCalculationMethod"in data?data.widthCalculationMethod:widthCalcMode}function setupCustomCalcMethods(calcMode,calcFunc){if("function"===typeof calcMode){log("Setup custom "+calcFunc+"CalcMethod");customCalcMethods[calcFunc]=calcMode;calcMode="custom"}return calcMode}if("iFrameResizer"in window&&Object===window.iFrameResizer.constructor){readData();heightCalcMode=setupCustomCalcMethods(heightCalcMode,"height");widthCalcMode=setupCustomCalcMethods(widthCalcMode,"width")}log("TargetOrigin for parent set to: "+targetOriginDefault)}function chkCSS(attr,value){if(-1!==value.indexOf("-")){warn("Negative CSS value ignored for "+attr);value=""}return value}function setBodyStyle(attr,value){if(undefined!==value&&""!==value&&"null"!==value){document.body.style[attr]=value;log("Body "+attr+' set to "'+value+'"')}}function setMargin(){if(undefined===bodyMarginStr){bodyMarginStr=bodyMargin+"px"}setBodyStyle("margin",chkCSS("margin",bodyMarginStr))}function stopInfiniteResizingOfIFrame(){document.documentElement.style.height="";document.body.style.height="";log('HTML & body height set to "auto"')}function manageTriggerEvent(options){function handleEvent(){sendSize(options.eventName,options.eventType)}var listener={add:function(eventName){addEventListener(window,eventName,handleEvent)},remove:function(eventName){removeEventListener(window,eventName,handleEvent)}};if(options.eventNames&&Array.prototype.map){options.eventName=options.eventNames[0];options.eventNames.map(listener[options.method])}else{listener[options.method](options.eventName)}log(capitalizeFirstLetter(options.method)+" event listener: "+options.eventType)}function manageEventListeners(method){manageTriggerEvent({method:method,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]});manageTriggerEvent({method:method,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]});manageTriggerEvent({method:method,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]});manageTriggerEvent({method:method,eventType:"Input",eventName:"input"});manageTriggerEvent({method:method,eventType:"Mouse Up",eventName:"mouseup"});manageTriggerEvent({method:method,eventType:"Mouse Down",eventName:"mousedown"});manageTriggerEvent({method:method,eventType:"Orientation Change",eventName:"orientationchange"});manageTriggerEvent({method:method,eventType:"Print",eventName:["afterprint","beforeprint"]});manageTriggerEvent({method:method,eventType:"Ready State Change",eventName:"readystatechange"});manageTriggerEvent({method:method,eventType:"Touch Start",eventName:"touchstart"});manageTriggerEvent({method:method,eventType:"Touch End",eventName:"touchend"});manageTriggerEvent({method:method,eventType:"Touch Cancel",eventName:"touchcancel"});manageTriggerEvent({method:method,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]});manageTriggerEvent({method:method,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]});manageTriggerEvent({method:method,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]});if("child"===resizeFrom){manageTriggerEvent({method:method,eventType:"IFrame Resized",eventName:"resize"})}}function checkCalcMode(calcMode,calcModeDefault,modes,type){if(calcModeDefault!==calcMode){if(!(calcMode in modes)){warn(calcMode+" is not a valid option for "+type+"CalculationMethod.");calcMode=calcModeDefault}log(type+' calculation method set to "'+calcMode+'"')}return calcMode}function checkHeightMode(){heightCalcMode=checkCalcMode(heightCalcMode,heightCalcModeDefault,getHeight,"height")}function checkWidthMode(){widthCalcMode=checkCalcMode(widthCalcMode,widthCalcModeDefault,getWidth,"width")}function startEventListeners(){if(true===autoResize){manageEventListeners("add");setupMutationObserver()}else{log("Auto Resize disabled")}}function stopMsgsToParent(){log("Disable outgoing messages");sendPermit=false}function removeMsgListener(){log("Remove event listener: Message");removeEventListener(window,"message",receiver)}function disconnectMutationObserver(){if(null!==bodyObserver){bodyObserver.disconnect()}}function stopEventListeners(){manageEventListeners("remove");disconnectMutationObserver();clearInterval(intervalTimer)}function teardown(){stopMsgsToParent();removeMsgListener();if(true===autoResize)stopEventListeners()}function injectClearFixIntoBodyElement(){var clearFix=document.createElement("div");clearFix.style.clear="both";clearFix.style.display="block";document.body.appendChild(clearFix)}function setupInPageLinks(){function getPagePosition(){return{x:window.pageXOffset!==undefined?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==undefined?window.pageYOffset:document.documentElement.scrollTop}}function getElementPosition(el){var elPosition=el.getBoundingClientRect(),pagePosition=getPagePosition();return{x:parseInt(elPosition.left,10)+parseInt(pagePosition.x,10),y:parseInt(elPosition.top,10)+parseInt(pagePosition.y,10)}}function findTarget(location){function jumpToTarget(target){var jumpPosition=getElementPosition(target);log("Moving to in page link (#"+hash+") at x: "+jumpPosition.x+" y: "+jumpPosition.y);sendMsg(jumpPosition.y,jumpPosition.x,"scrollToOffset")}var hash=location.split("#")[1]||location,hashData=decodeURIComponent(hash),target=document.getElementById(hashData)||document.getElementsByName(hashData)[0];if(undefined!==target){jumpToTarget(target)}else{log("In page link (#"+hash+") not found in iFrame, so sending to parent");sendMsg(0,0,"inPageLink","#"+hash)}}function checkLocationHash(){if(""!==location.hash&&"#"!==location.hash){findTarget(location.href)}}function bindAnchors(){function setupLink(el){function linkClicked(e){e.preventDefault();findTarget(this.getAttribute("href"))}if("#"!==el.getAttribute("href")){addEventListener(el,"click",linkClicked)}}Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),setupLink)}function bindLocationHash(){addEventListener(window,"hashchange",checkLocationHash)}function initCheck(){setTimeout(checkLocationHash,eventCancelTimer)}function enableInPageLinks(){if(Array.prototype.forEach&&document.querySelectorAll){log("Setting up location.hash handlers");bindAnchors();bindLocationHash();initCheck()}else{warn("In page linking not fully supported in this browser! (See README.md for IE8 workaround)")}}if(inPageLinks.enable){enableInPageLinks()}else{log("In page linking not enabled")}return{findTarget:findTarget}}function setupPublicMethods(){log("Enable public methods");win.parentIFrame={autoResize:function autoResizeF(resize){if(true===resize&&false===autoResize){autoResize=true;startEventListeners()}else if(false===resize&&true===autoResize){autoResize=false;stopEventListeners()}return autoResize},close:function closeF(){sendMsg(0,0,"close");teardown()},getId:function getIdF(){return myID},getPageInfo:function getPageInfoF(callback){if("function"===typeof callback){pageInfoCallback=callback;sendMsg(0,0,"pageInfo")}else{pageInfoCallback=function(){};sendMsg(0,0,"pageInfoStop")}},moveToAnchor:function moveToAnchorF(hash){inPageLinks.findTarget(hash)},reset:function resetF(){resetIFrame("parentIFrame.reset")},scrollTo:function scrollToF(x,y){sendMsg(y,x,"scrollTo")},scrollToOffset:function scrollToF(x,y){sendMsg(y,x,"scrollToOffset")},sendMessage:function sendMessageF(msg,targetOrigin){sendMsg(0,0,"message",JSON.stringify(msg),targetOrigin)},setHeightCalculationMethod:function setHeightCalculationMethodF(heightCalculationMethod){heightCalcMode=heightCalculationMethod;checkHeightMode()},setWidthCalculationMethod:function setWidthCalculationMethodF(widthCalculationMethod){widthCalcMode=widthCalculationMethod;checkWidthMode()},setTargetOrigin:function setTargetOriginF(targetOrigin){log("Set targetOrigin: "+targetOrigin);targetOriginDefault=targetOrigin},size:function sizeF(customHeight,customWidth){var valString=""+(customHeight?customHeight:"")+(customWidth?","+customWidth:"");sendSize("size","parentIFrame.size("+valString+")",customHeight,customWidth)}}}function initInterval(){if(0!==interval){log("setInterval: "+interval+"ms");intervalTimer=setInterval(function(){sendSize("interval","setInterval: "+interval)},Math.abs(interval))}}function setupBodyMutationObserver(){function addImageLoadListners(mutation){function addImageLoadListener(element){if(false===element.complete){log("Attach listeners to "+element.src);element.addEventListener("load",imageLoaded,false);element.addEventListener("error",imageError,false);elements.push(element)}}if(mutation.type==="attributes"&&mutation.attributeName==="src"){addImageLoadListener(mutation.target)}else if(mutation.type==="childList"){Array.prototype.forEach.call(mutation.target.querySelectorAll("img"),addImageLoadListener)}}function removeFromArray(element){elements.splice(elements.indexOf(element),1)}function removeImageLoadListener(element){log("Remove listeners from "+element.src);element.removeEventListener("load",imageLoaded,false);element.removeEventListener("error",imageError,false);removeFromArray(element)}function imageEventTriggered(event,type,typeDesc){removeImageLoadListener(event.target);sendSize(type,typeDesc+": "+event.target.src,undefined,undefined)}function imageLoaded(event){imageEventTriggered(event,"imageLoad","Image loaded")}function imageError(event){imageEventTriggered(event,"imageLoadFailed","Image load failed")}function mutationObserved(mutations){sendSize("mutationObserver","mutationObserver: "+mutations[0].target+" "+mutations[0].type);mutations.forEach(addImageLoadListners)}function createMutationObserver(){var target=document.querySelector("body"),config={attributes:true,attributeOldValue:false,characterData:true,characterDataOldValue:false,childList:true,subtree:true};observer=new MutationObserver(mutationObserved);log("Create body MutationObserver");observer.observe(target,config);return observer}var elements=[],MutationObserver=window.MutationObserver||window.WebKitMutationObserver,observer=createMutationObserver();return{disconnect:function(){if("disconnect"in observer){log("Disconnect body MutationObserver");observer.disconnect();elements.forEach(removeImageLoadListener)}}}}function setupMutationObserver(){var forceIntervalTimer=0>interval;if(window.MutationObserver||window.WebKitMutationObserver){if(forceIntervalTimer){initInterval()}else{bodyObserver=setupBodyMutationObserver()}}else{log("MutationObserver not supported in this browser!");initInterval()}}function getComputedStyle(prop,el){function convertUnitsToPxForIE8(value){var PIXEL=/^\d+(px)?$/i;if(PIXEL.test(value)){return parseInt(value,base)}var style=el.style.left,runtimeStyle=el.runtimeStyle.left;el.runtimeStyle.left=el.currentStyle.left;el.style.left=value||0;value=el.style.pixelLeft;el.style.left=style;el.runtimeStyle.left=runtimeStyle;return value}var retVal=0;el=el||document.body;if("defaultView"in document&&"getComputedStyle"in document.defaultView){retVal=document.defaultView.getComputedStyle(el,null);retVal=null!==retVal?retVal[prop]:0}else{retVal=convertUnitsToPxForIE8(el.currentStyle[prop])}return parseInt(retVal,base)}function chkEventThottle(timer){if(timer>throttledTimer/2){throttledTimer=2*timer;log("Event throttle increased to "+throttledTimer+"ms")}}function getMaxElement(side,elements){var elementsLength=elements.length,elVal=0,maxVal=0,Side=capitalizeFirstLetter(side),timer=getNow();for(var i=0;i<elementsLength;i++){elVal=elements[i].getBoundingClientRect()[side]+getComputedStyle("margin"+Side,elements[i]);if(elVal>maxVal){maxVal=elVal}}timer=getNow()-timer;log("Parsed "+elementsLength+" HTML elements");log("Element position calculated in "+timer+"ms");chkEventThottle(timer);return maxVal}function getAllMeasurements(dimention){return[dimention.bodyOffset(),dimention.bodyScroll(),dimention.documentElementOffset(),dimention.documentElementScroll()]}function getTaggedElements(side,tag){function noTaggedElementsFound(){warn("No tagged elements ("+tag+") found on page");return height}var elements=document.querySelectorAll("["+tag+"]");return 0===elements.length?noTaggedElementsFound():getMaxElement(side,elements)}function getAllElements(){return document.querySelectorAll("body *")}var getHeight={bodyOffset:function getBodyOffsetHeight(){return document.body.offsetHeight+getComputedStyle("marginTop")+getComputedStyle("marginBottom")},offset:function(){return getHeight.bodyOffset()},bodyScroll:function getBodyScrollHeight(){return document.body.scrollHeight},custom:function getCustomWidth(){return customCalcMethods.height()},documentElementOffset:function getDEOffsetHeight(){return document.documentElement.offsetHeight},documentElementScroll:function getDEScrollHeight(){return document.documentElement.scrollHeight},max:function getMaxHeight(){return Math.max.apply(null,getAllMeasurements(getHeight))},min:function getMinHeight(){return Math.min.apply(null,getAllMeasurements(getHeight))},grow:function growHeight(){return getHeight.max()},lowestElement:function getBestHeight(){return Math.max(getHeight.bodyOffset(),getMaxElement("bottom",getAllElements()))},taggedElement:function getTaggedElementsHeight(){return getTaggedElements("bottom","data-iframe-height")}},getWidth={bodyScroll:function getBodyScrollWidth(){return document.body.scrollWidth},bodyOffset:function getBodyOffsetWidth(){return document.body.offsetWidth},custom:function getCustomWidth(){return customCalcMethods.width()},documentElementScroll:function getDEScrollWidth(){return document.documentElement.scrollWidth},documentElementOffset:function getDEOffsetWidth(){return document.documentElement.offsetWidth},scroll:function getMaxWidth(){return Math.max(getWidth.bodyScroll(),getWidth.documentElementScroll())},max:function getMaxWidth(){return Math.max.apply(null,getAllMeasurements(getWidth))},min:function getMinWidth(){return Math.min.apply(null,getAllMeasurements(getWidth))},rightMostElement:function rightMostElement(){return getMaxElement("right",getAllElements())},taggedElement:function getTaggedElementsWidth(){return getTaggedElements("right","data-iframe-width")}};function sizeIFrame(triggerEvent,triggerEventDesc,customHeight,customWidth){function resizeIFrame(){height=currentHeight;width=currentWidth;sendMsg(height,width,triggerEvent)}function isSizeChangeDetected(){function checkTolarance(a,b){var retVal=Math.abs(a-b)<=tolerance;return!retVal}currentHeight=undefined!==customHeight?customHeight:getHeight[heightCalcMode]();currentWidth=undefined!==customWidth?customWidth:getWidth[widthCalcMode]();return checkTolarance(height,currentHeight)||calculateWidth&&checkTolarance(width,currentWidth)}function isForceResizableEvent(){return!(triggerEvent in{init:1,interval:1,size:1})}function isForceResizableCalcMode(){return heightCalcMode in resetRequiredMethods||calculateWidth&&widthCalcMode in resetRequiredMethods}function logIgnored(){log("No change in size detected")}function checkDownSizing(){if(isForceResizableEvent()&&isForceResizableCalcMode()){resetIFrame(triggerEventDesc)}else if(!(triggerEvent in{interval:1})){logIgnored()}}var currentHeight,currentWidth;if(isSizeChangeDetected()||"init"===triggerEvent){lockTrigger();resizeIFrame()}else{checkDownSizing()}}var sizeIFrameThrottled=throttle(sizeIFrame);function sendSize(triggerEvent,triggerEventDesc,customHeight,customWidth){function recordTrigger(){if(!(triggerEvent in{reset:1,resetPage:1,init:1})){log("Trigger event: "+triggerEventDesc)}}function isDoubleFiredEvent(){return triggerLocked&&triggerEvent in doubleEventList}if(!isDoubleFiredEvent()){recordTrigger();sizeIFrameThrottled(triggerEvent,triggerEventDesc,customHeight,customWidth)}else{log("Trigger event cancelled: "+triggerEvent)}}function lockTrigger(){if(!triggerLocked){triggerLocked=true;log("Trigger event lock on")}clearTimeout(triggerLockedTimer);triggerLockedTimer=setTimeout(function(){triggerLocked=false;log("Trigger event lock off");log("--")},eventCancelTimer)}function triggerReset(triggerEvent){height=getHeight[heightCalcMode]();width=getWidth[widthCalcMode]();sendMsg(height,width,triggerEvent)}function resetIFrame(triggerEventDesc){var hcm=heightCalcMode;heightCalcMode=heightCalcModeDefault;log("Reset trigger event: "+triggerEventDesc);lockTrigger();triggerReset("reset");heightCalcMode=hcm}function sendMsg(height,width,triggerEvent,msg,targetOrigin){function setTargetOrigin(){if(undefined===targetOrigin){targetOrigin=targetOriginDefault}else{log("Message targetOrigin: "+targetOrigin)}}function sendToParent(){var size=height+":"+width,message=myID+":"+size+":"+triggerEvent+(undefined!==msg?":"+msg:"");log("Sending message to host page ("+message+")");target.postMessage(msgID+message,targetOrigin)}if(true===sendPermit){setTargetOrigin();sendToParent()}}function receiver(event){function isMessageForUs(){return msgID===(""+event.data).substr(0,msgIdLen)}function initFromParent(){function fireInit(){initMsg=event.data;target=event.source;init();firstRun=false;setTimeout(function(){initLock=false},eventCancelTimer)}if(document.body){fireInit()}else{log("Waiting for page ready");addEventListener(window,"readystatechange",initFromParent)}}function resetFromParent(){if(!initLock){log("Page size reset by host page");triggerReset("resetPage")}else{log("Page reset ignored by init")}}function resizeFromParent(){sendSize("resizeParent","Parent window requested size check")}function moveToAnchor(){var anchor=getData();inPageLinks.findTarget(anchor)}function getMessageType(){return event.data.split("]")[1].split(":")[0]}function getData(){return event.data.substr(event.data.indexOf(":")+1)}function isMiddleTier(){return"iFrameResize"in window}function messageFromParent(){var msgBody=getData();log("MessageCallback called from parent: "+msgBody);messageCallback(JSON.parse(msgBody));log(" --")}function pageInfoFromParent(){var msgBody=getData();log("PageInfoFromParent called from parent: "+msgBody);pageInfoCallback(JSON.parse(msgBody));log(" --")}function isInitMsg(){return event.data.split(":")[2]in{true:1,false:1}}function callFromParent(){switch(getMessageType()){case"reset":resetFromParent();break;case"resize":resizeFromParent();break;case"inPageLink":case"moveToAnchor":moveToAnchor();break;case"message":messageFromParent();break;case"pageInfo":pageInfoFromParent();break;default:if(!isMiddleTier()&&!isInitMsg()){warn("Unexpected message ("+event.data+")")}}}function processMessage(){if(false===firstRun){callFromParent()}else if(isInitMsg()){initFromParent()}else{log('Ignored message of type "'+getMessageType()+'". Received before initialization.')}}if(isMessageForUs()){processMessage()}}function chkLateLoaded(){if("loading"!==document.readyState){window.parent.postMessage("[iFrameResizerChild]Ready","*")}}addEventListener(window,"message",receiver);chkLateLoaded()})(window||{})},{}],9:[function(require,module,exports){"use strict";module.exports=require("./src/client")},{"./src/client":10}],10:[function(require,module,exports){"use strict";var inherits=require("inherits"),Promise=require("lie");var Port=require("./port"),resizer=require("./plugins/iframe-resizer/client"),syncLang=require("./plugins/sync-lang/client"),syncTitle=require("./plugins/sync-title/client"),syncFont=require("./plugins/sync-font/client");function Client(options){if(!(this instanceof Client)){return new Client(options)}options=options||{};Port.call(this,window.parent,"*",options);if(options.syncLang){this.use(syncLang)}if(options.syncTitle!==false){this.use(syncTitle)}if(options.syncFont){this.use(syncFont)}if(options.resizeFrame!==false){this.use(resizer)}}inherits(Client,Port);Client.prototype.connect=function connect(){var me=this;return new Promise(function(resolve){me.open();me._sendMessage("evt","ready");Port.prototype.connect.call(me);resolve(me)})};module.exports=Client},{"./plugins/iframe-resizer/client":11,"./plugins/sync-font/client":12,"./plugins/sync-lang/client":13,"./plugins/sync-title/client":14,"./port":16,inherits:22,lie:23}],11:[function(require,module,exports){"use strict";module.exports=function(client){window.iframeResizer={targetOrigin:client._targetOrigin};require("iframe-resizer/js/iframeResizer.contentWindow")}},{"iframe-resizer/js/iframeResizer.contentWindow":8}],12:[function(require,module,exports){"use strict";module.exports=function clientSyncFont(client){return client.request("font").then(function(font){var size=font.size;if(!font.visualRedesign){switch(font.size){case"11px":size="18px";break;case"17px":size="22px";break;case"26px":size="24px";break;default:size="20px";break}}document.documentElement.style.fontSize=size;if(font.dyslexic){document.body.classList.add("vui-dyslexic")}})}},{}],13:[function(require,module,exports){"use strict";module.exports=function clientSyncLang(client){return client.request("lang").then(function(lang){var htmlElem=document.getElementsByTagName("html")[0];htmlElem.setAttribute("lang",lang.lang);if(lang.fallback){htmlElem.setAttribute("data-lang-default",lang.fallback)}if(lang.isRtl){document.body.dir="rtl"}})}},{}],14:[function(require,module,exports){"use strict";function installClientPolling(sync){var title="";setInterval(function(){var newTitle=document.title;if(newTitle!==title){title=newTitle;sync(title)}},100)}function installClientMutation(sync){var elem=document.querySelector("title");if(elem===null){elem=document.createElement("title");document.getElementsByTagName("head")[0].appendChild(elem)}sync(document.title);var observer=new window.MutationObserver(function(mutations){sync(mutations[0].target.textContent)});observer.observe(elem,{subtree:true,characterData:true,childList:true})}module.exports=function clientSyncTitle(client){function sync(value){client.sendEvent("title",value)}if("MutationObserver"in window){installClientMutation(sync)}else{installClientPolling(sync)}}},{}],15:[function(require,module,exports){
"use strict";var uuid=require("uuid");var validateEvent=require("./validate-event");function Port(endpoint,targetOrigin,options){if(!(this instanceof Port)){return new Port(endpoint,targetOrigin,options)}options=options||{};this._connectQueue=[];this._debugEnabled=options.debug||false;this._endpoint=endpoint;this._eventHandlers={};this._isConnected=false;this._isOpen=false;this._messageHandlers={};this._onCloseCallbacks=[];this._targetOrigin=targetOrigin;this._id=uuid();var me=this;this._onMessage("evt",function(){me._receiveEvent.apply(me,arguments)})}Port.prototype.close=function close(){if(!this._isOpen){throw new Error("Port cannot be closed, call open() first")}this._isOpen=false;this._isConnected=false;window.removeEventListener("message",this._receiveMessage);this._onCloseCallbacks.forEach(function(cb){cb()});this.debug("closed")};Port.prototype.connect=function connect(){this._isConnected=true;this.debug("connected");this._connectQueue.forEach(function(func){func()});this._connectQueue=[];return this};Port.prototype.debug=function debug(msg){if(this._debugEnabled){console.log(msg)}};Port.prototype._initHashArrAndPush=function initHashArrAndPush(dic,key,obj){if(dic[key]===undefined){dic[key]=[]}dic[key].push(obj)};Port.prototype.onClose=function onClose(cb){this._onCloseCallbacks.push(cb)};Port.prototype.onEvent=function onEvent(eventType,handler){this.debug('onEvent handler added for "'+eventType+'"');if(this._isConnected){this.debug("You've attached event handlers after connecting, you may have missed some events")}this._initHashArrAndPush(this._eventHandlers,eventType,handler);return this};Port.prototype.open=function open(){if(this._isOpen){throw new Error("Port is already open.")}this._isOpen=true;window.addEventListener("message",this._receiveMessage.bind(this),false);this.debug("opened");return this};Port.prototype._receiveMessage=function receiveMessage(e){if(!validateEvent(this._targetOrigin,this._endpoint,e)){return}var clazz=e.data.key.substr(5,3);var key=e.data.key.substr(9);this.debug("received "+clazz+"."+key);var handler=this._messageHandlers[clazz];if(handler){handler.call(this,key,e.data.payload)}};Port.prototype._onMessage=function onMessage(clazz,handler){if(clazz.length!==3){throw new Error("message class name must be 3 characters")}this._messageHandlers[clazz]=handler};Port.prototype._receiveEvent=function receiveEvent(eventType,payload){if(this._eventHandlers[eventType]===undefined){return}this._eventHandlers[eventType].forEach(function(handler){handler.apply(handler,payload)})};Port.prototype._sendMessage=function sendMessage(clazz,key,data){var message={key:"frau."+clazz+"."+key,payload:data};this.debug("sending key: "+message.key);this._endpoint.postMessage(message,this._targetOrigin);return this};Port.prototype.sendEvent=function sendEvent(eventType){var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i])}if(!this._isConnected){var me=this;this._connectQueue.push(function(){me._sendMessage("evt",eventType,args)});return this}return this._sendMessage("evt",eventType,args)};Port.prototype.use=function use(fn){fn(this);return this};module.exports=Port},{"./validate-event":20,uuid:30}],16:[function(require,module,exports){"use strict";module.exports=require("./services")},{"./services":18}],17:[function(require,module,exports){"use strict";var inherits=require("inherits"),Promise=require("lie");var Port=require("./base");var fromError=require("./transform-error").fromError,toError=require("./transform-error").toError;function PortWithRequests(){if(!(this instanceof PortWithRequests)){return new PortWithRequests.apply(this,arguments)}Port.apply(this,arguments);this._pendingRequests={};this._requestHandlers={};this._requestCounter=0;this._waitingRequests=[];var me=this;this._onMessage("req",function(){me._receiveRequest.apply(me,arguments)});this._onMessage("res",function(){me._receiveRequestResponse.apply(me,arguments)})}inherits(PortWithRequests,Port);PortWithRequests.prototype.request=function request(requestType){var args=new Array(arguments.length-1);for(var i=1;i<arguments.length;++i){args[i-1]=arguments[i]}var me=this;return new Promise(function(resolve,reject){var counter=++me._requestCounter;var id=me._id+"_"+counter;me._initHashArrAndPush(me._pendingRequests,requestType,{id:id,resolve:resolve,reject:reject});function finish(){me._sendMessage("req",requestType,{id:id,args:args})}if(!me._isConnected){me._connectQueue.push(finish)}else{finish()}})};PortWithRequests.prototype.onRequest=function onRequest(requestType,handler){if(this._isConnected){throw new Error("Add request handlers before connecting")}if(this._requestHandlers[requestType]!==undefined){throw new Error('Duplicate onRequest handler for type "'+requestType+'"')}this.debug('onRequest handler added for "'+requestType+'"');this._requestHandlers[requestType]=handler;this._sendRequestResponse(requestType);return this};PortWithRequests.prototype._receiveRequest=function receiveRequest(requestType,payload){this._initHashArrAndPush(this._waitingRequests,requestType,payload);this._sendRequestResponse(requestType)};PortWithRequests.prototype._sendRequestResponse=function sendRequestResponse(requestType){var handler=this._requestHandlers[requestType];var waiting=this._waitingRequests[requestType];delete this._waitingRequests[requestType];if(handler===undefined||waiting===undefined||waiting.length===0){return}var me=this;waiting.forEach(function(w){Promise.resolve().then(function(){if(typeof handler==="function"){return handler.apply(handler,w.args)}return handler}).then(function(val){me._sendMessage("res",requestType,{id:w.id,val:val})}).catch(function(e){var err=fromError(e);me._sendMessage("res",requestType,{id:w.id,err:err})})})};PortWithRequests.prototype._receiveRequestResponse=function receiveRequestResponse(requestType,payload){var requests=this._pendingRequests[requestType];if(requests===undefined){return}for(var i=0;i<requests.length;++i){var req=requests[i];if(req.id!==payload.id){continue}if(payload.hasOwnProperty("err")){var error=toError(payload.err);req.reject(error)}else{req.resolve(payload.val)}requests.splice(i,1);return}};module.exports=PortWithRequests},{"./base":15,"./transform-error":19,inherits:22,lie:23}],18:[function(require,module,exports){"use strict";var inherits=require("inherits");var PortWithRequests=require("./requests");var typeNameValidator=/^[a-zA-Z]+[a-zA-Z\-]*$/;function PortWithServices(){if(!(this instanceof PortWithServices)){return new PortWithServices.apply(this,arguments)}PortWithRequests.apply(this,arguments)}inherits(PortWithServices,PortWithRequests);PortWithServices.prototype.getService=function getService(sericeType,version){if(!this._isConnected){throw new Error("Cannot getService() before connect() has completed")}var serviceVersionPrefix="service:"+sericeType+":"+version;var me=this;function createProxy(methodNames){function createProxyMethod(name){return function(){var args=new Array(arguments.length+1);args[0]=serviceVersionPrefix+":"+name;for(var i=0;i<arguments.length;++i){args[i+1]=arguments[i]}return me.request.apply(me,args)}}var proxy={};methodNames.forEach(function(name){proxy[name]=createProxyMethod(name)});return proxy}return me.request(serviceVersionPrefix).then(createProxy)};PortWithServices.prototype.registerService=function registerService(serviceType,version,service){if(this._isConnected){throw new Error("Register services before connecting")}if(!typeNameValidator.test(serviceType)){throw new Error('Invalid service type "'+serviceType+'"')}var serviceVersionPrefix="service:"+serviceType+":"+version;var methodNames=Object.keys(service).filter(function(k){return typeof service[k]==="function"});this.onRequest(serviceVersionPrefix,methodNames);var me=this;methodNames.forEach(function(name){me.onRequest(serviceVersionPrefix+":"+name,service[name])});return this};module.exports=PortWithServices},{"./requests":17,inherits:22}],19:[function(require,module,exports){"use strict";var ERROR_OBJECT_SENTINEL="_ifrau-error-object";function deErrorifyArray(input){var result=input.map(deErrorify);return result}function errorifyArray(input){var result=input.map(errorify);return result}function deErrorifyObject(input){var isError=input instanceof Error;var result=isError?{props:{}}:{};if(isError){result.message=input.message;result.name=input.name;result[ERROR_OBJECT_SENTINEL]=true}var propTarget=isError?result.props:result;Object.keys(input).forEach(function(key){var prop=deErrorify(input[key]);propTarget[key]=prop});return result}function errorifyObject(input){var isError=input[ERROR_OBJECT_SENTINEL]===true;var result=isError?new Error(input.message):{};if(isError){result.name=input.name}var propSource=isError?input.props:input;Object.keys(propSource).forEach(function(key){var prop=errorify(propSource[key]);result[key]=prop});return result}function deErrorify(input){if(input!==null&&typeof input==="object"){if(Array.isArray(input)){return deErrorifyArray(input)}return deErrorifyObject(input)}if(typeof input==="function"){return null}return input}function errorify(input){if(input!==null&&typeof input==="object"){if(Array.isArray(input)){return errorifyArray(input)}return errorifyObject(input)}return input}module.exports.ERROR_OBJECT_SENTINEL=ERROR_OBJECT_SENTINEL;module.exports.fromError=deErrorify;module.exports.toError=errorify},{}],20:[function(require,module,exports){"use strict";function isStringEmpty(str){return!str||0===str.length}function validateEvent(targetOrigin,endpoint,e){var isValid=e.source===endpoint&&(targetOrigin==="*"||!isStringEmpty(targetOrigin)&&!isStringEmpty(e.origin)&&targetOrigin.toUpperCase()===e.origin.toUpperCase())&&e.data.key!==undefined&&e.data.key!==null&&e.data.key.indexOf("frau.")===0;return isValid}module.exports=validateEvent},{}],21:[function(require,module,exports){(function(global){"use strict";var Mutation=global.MutationObserver||global.WebKitMutationObserver;var scheduleDrain;{if(Mutation){var called=0;var observer=new Mutation(nextTick);var element=global.document.createTextNode("");observer.observe(element,{characterData:true});scheduleDrain=function(){element.data=called=++called%2}}else if(!global.setImmediate&&typeof global.MessageChannel!=="undefined"){var channel=new global.MessageChannel;channel.port1.onmessage=nextTick;scheduleDrain=function(){channel.port2.postMessage(0)}}else if("document"in global&&"onreadystatechange"in global.document.createElement("script")){scheduleDrain=function(){var scriptEl=global.document.createElement("script");scriptEl.onreadystatechange=function(){nextTick();scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null};global.document.documentElement.appendChild(scriptEl)}}else{scheduleDrain=function(){setTimeout(nextTick,0)}}}var draining;var queue=[];function nextTick(){draining=true;var i,oldQueue;var len=queue.length;while(len){oldQueue=queue;queue=[];i=-1;while(++i<len){oldQueue[i]()}len=queue.length}draining=false}module.exports=immediate;function immediate(task){if(queue.push(task)===1&&!draining){scheduleDrain()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],22:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],23:[function(require,module,exports){"use strict";var immediate=require("immediate");function INTERNAL(){}var handlers={};var REJECTED=["REJECTED"];var FULFILLED=["FULFILLED"];var PENDING=["PENDING"];module.exports=Promise;function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function")}this.state=PENDING;this.queue=[];this.outcome=void 0;if(resolver!==INTERNAL){safelyResolveThenable(this,resolver)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!=="function"&&this.state===FULFILLED||typeof onRejected!=="function"&&this.state===REJECTED){return this}var promise=new this.constructor(INTERNAL);if(this.state!==PENDING){var resolver=this.state===FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome)}else{this.queue.push(new QueueItem(promise,onFulfilled,onRejected))}return promise};function QueueItem(promise,onFulfilled,onRejected){this.promise=promise;if(typeof onFulfilled==="function"){this.onFulfilled=onFulfilled;this.callFulfilled=this.otherCallFulfilled}if(typeof onRejected==="function"){this.onRejected=onRejected;this.callRejected=this.otherCallRejected}}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)};QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)};QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)};QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)};function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}if(returnValue===promise){handlers.reject(promise,new TypeError("Cannot resolve promise with itself"))}else{handlers.resolve(promise,returnValue)}})}handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if(result.status==="error"){return handlers.reject(self,result.value)}var thenable=result.value;if(thenable){safelyResolveThenable(self,thenable)}else{self.state=FULFILLED;self.outcome=value;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callFulfilled(value)}}return self};handlers.reject=function(self,error){self.state=REJECTED;self.outcome=error;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callRejected(error)}return self};function getThen(obj){var then=obj&&obj.then;if(obj&&typeof obj==="object"&&typeof then==="function"){return function appyThen(){then.apply(obj,arguments)}}}function safelyResolveThenable(self,thenable){var called=false;function onError(value){if(called){return}called=true;handlers.reject(self,value)}function onSuccess(value){if(called){return}called=true;handlers.resolve(self,value)}function tryToUnwrap(){thenable(onSuccess,onError)}var result=tryCatch(tryToUnwrap);if(result.status==="error"){onError(result.value)}}function tryCatch(func,value){var out={};try{out.value=func(value);out.status="success"}catch(e){out.status="error";out.value=e}return out}Promise.resolve=resolve;function resolve(value){if(value instanceof this){return value}return handlers.resolve(new this(INTERNAL),value)}Promise.reject=reject;function reject(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)}Promise.all=all;function all(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return this.resolve([])}var values=new Array(len);var resolved=0;var i=-1;var promise=new this(INTERNAL);while(++i<len){allResolver(iterable[i],i)}return promise;function allResolver(value,i){self.resolve(value).then(resolveFromAll,function(error){if(!called){called=true;handlers.reject(promise,error)}});function resolveFromAll(outValue){values[i]=outValue;if(++resolved===len&&!called){called=true;handlers.resolve(promise,values)}}}}Promise.race=race;function race(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return this.resolve([])}var i=-1;var promise=new this(INTERNAL);while(++i<len){resolver(iterable[i])}return promise;function resolver(value){self.resolve(value).then(function(response){if(!called){called=true;handlers.resolve(promise,response)}},function(error){if(!called){called=true;handlers.reject(promise,error)}})}}},{immediate:21}],24:[function(require,module,exports){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}},{}],25:[function(require,module,exports){var Emitter=require("emitter");var reduce=require("reduce");var requestBase=require("./request-base");var isObject=require("./is-object");var root;if(typeof window!=="undefined"){root=window}else if(typeof self!=="undefined"){root=self}else{root=this}function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}var request=module.exports=require("./request").bind(null,Request);request.getXHR=function(){if(root.XMLHttpRequest&&(!root.location||"file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false};var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){if(null!=obj[key]){pushEncodedKeyValuePair(pairs,key,obj[key])}}return pairs.join("&")}function pushEncodedKeyValuePair(pairs,key,val){if(Array.isArray(val)){return val.forEach(function(v){pushEncodedKeyValuePair(pairs,key,v)})}pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(val))}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function isJSON(mime){return/[\/+]json\b/.test(mime)}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(req,options){options=options||{};this.req=req;this.xhr=this.req.xhr;this.text=this.req.method!="HEAD"&&(this.xhr.responseType===""||this.xhr.responseType==="text")||typeof this.xhr.responseType==="undefined"?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this.setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this.parseBody(this.text?this.text:this.xhr.response):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];if(!parse&&isJSON(this.type)){parse=request.parse["application/json"]}return parse&&str&&(str.length||str instanceof Object)?parse(str):null};Response.prototype.setStatusProperties=function(status){if(status===1223){status=204}var type=status/100|0;this.status=this.statusCode=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var url=req.url;var msg="cannot "+method+" "+url+" ("+this.status+")";var err=new Error(msg);err.status=this.status;err.method=method;err.url=url;return err};request.Response=Response;function Request(method,url){var self=this;this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on("end",function(){var err=null;var res=null;try{res=new Response(self)}catch(e){err=new Error("Parser is unable to parse the response");err.parse=true;err.original=e;err.rawResponse=self.xhr&&self.xhr.responseText?self.xhr.responseText:null;err.statusCode=self.xhr&&self.xhr.status?self.xhr.status:null;return self.callback(err)}self.emit("response",res);if(err){return self.callback(err,res)}if(res.status>=200&&res.status<300){return self.callback(err,res)}var new_err=new Error(res.statusText||"Unsuccessful HTTP response");new_err.original=err;new_err.response=res;new_err.status=res.status;self.callback(new_err,res)})}Emitter(Request.prototype);for(var key in requestBase){Request.prototype[key]=requestBase[key]}Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr&&this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.responseType=function(val){this._responseType=val;return this};Request.prototype.accept=function(type){this.set("Accept",request.types[type]||type);return this};Request.prototype.auth=function(user,pass,options){if(!options){options={type:"basic"}}switch(options.type){case"basic":var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);break;case"auto":this.username=user;this.password=pass;break}return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.attach=function(field,file,filename){this._getFormData().append(field,file,filename||file.name);return this};Request.prototype._getFormData=function(){if(!this._formData){this._formData=new root.FormData}return this._formData};Request.prototype.send=function(data){var obj=isObject(data);var type=this._header["content-type"];if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this._header["content-type"];if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj||isHost(data))return this;if(!type)this.type("json");return this};Response.prototype.parse=function serialize(fn){if(root.console){console.warn("Client-side parse() method has been renamed to serialize(). This method is not compatible with superagent v2.0")}this.serialize(fn);return this};Response.prototype.serialize=function serialize(fn){this._parser=fn;return this};Request.prototype.callback=function(err,res){var fn=this._callback;this.clearTimeout();fn(err,res)};Request.prototype.crossDomainError=function(){var err=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");err.crossDomain=true;err.status=this.status;err.method=this.method;err.url=this.url;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=request.getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._formData||this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;var status;try{status=xhr.status}catch(e){status=0}if(0==status){if(self.timedout)return self.timeoutError();if(self.aborted)return;return self.crossDomainError()}self.emit("end")};var handleProgress=function(e){if(e.total>0){e.percent=e.loaded/e.total*100}e.direction="download";self.emit("progress",e)};if(this.hasListeners("progress")){xhr.onprogress=handleProgress}try{if(xhr.upload&&this.hasListeners("progress")){xhr.upload.onprogress=handleProgress}}catch(e){}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.timedout=true;self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}if(this.username&&this.password){xhr.open(this.method,this.url,true,this.username,this.password)}else{xhr.open(this.method,this.url,true)}if(this._withCredentials)xhr.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var contentType=this._header["content-type"];var serialize=this._parser||request.serialize[contentType?contentType.split(";")[0]:""];if(!serialize&&isJSON(contentType))serialize=request.serialize["application/json"];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}if(this._responseType){xhr.responseType=this._responseType}this.emit("request",this);xhr.send(typeof data!=="undefined"?data:null);return this};request.Request=Request;request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};function del(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req}request["del"]=del;request["delete"]=del;request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req}},{"./is-object":26,"./request":28,"./request-base":27,emitter:2,reduce:24}],26:[function(require,module,exports){function isObject(obj){return null!=obj&&"object"==typeof obj}module.exports=isObject},{}],27:[function(require,module,exports){var isObject=require("./is-object");exports.clearTimeout=function _clearTimeout(){this._timeout=0;clearTimeout(this._timer);return this};exports.parse=function parse(fn){this._parser=fn;return this};exports.timeout=function timeout(ms){this._timeout=ms;return this};exports.then=function then(fulfill,reject){return this.end(function(err,res){err?reject(err):fulfill(res)})};exports.use=function use(fn){fn(this);return this};exports.get=function(field){return this._header[field.toLowerCase()]};exports.getHeader=exports.get;exports.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};exports.unset=function(field){delete this._header[field.toLowerCase()];delete this.header[field];return this};exports.field=function(name,val){this._getFormData().append(name,val);return this}},{"./is-object":26}],28:[function(require,module,exports){function request(RequestConstructor,method,url){if("function"==typeof url){return new RequestConstructor("GET",method).end(url)}if(2==arguments.length){return new RequestConstructor("GET",method)}return new RequestConstructor(method,url)}module.exports=request},{}],29:[function(require,module,exports){(function(global){var rng;var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],30:[function(require,module,exports){var _rng=require("./rng");var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;module.exports=uuid},{"./rng":29}],31:[function(require,module,exports){"use strict";var Client=require("ifrau/client"),Promise=require("lie");var REQUEST_KEY=require("./request-key");module.exports=function getFramedJwt(scope){return Promise.resolve().then(function(){var client=new Client({resizeFrame:false,syncTitle:false});return client.connect().then(function(){return client.request(REQUEST_KEY,scope)})})}},{"./request-key":34,"ifrau/client":9,lie:23}],32:[function(require,module,exports){"use strict";var framed=require("frau-framed");var getFramed=require("./framed"),getLocal=require("./local");
module.exports=function frauJwt(){var fn=framed()?getFramed:getLocal;return fn.apply(fn,arguments)}},{"./framed":31,"./local":33,"frau-framed":3}],33:[function(require,module,exports){(function(global){"use strict";var Promise=require("lie"),request=require("superagent"),xsrfToken=require("frau-superagent-xsrf-token");var DEFAULT_SCOPE="*:*:*",TOKEN_ROUTE="/d2l/lp/auth/oauth2/token";var CACHED_TOKENS=null,IN_FLIGHT_REQUESTS=null,CLOCK_SKEW=0;resetCaches();function clock(){return Date.now()/1e3|0}function expired(token){return module.exports._clock()+CLOCK_SKEW>token.expires_at}function resetCaches(){CACHED_TOKENS=Object.create(null);IN_FLIGHT_REQUESTS=Object.create(null)}function cacheToken(scope,token){CACHED_TOKENS[scope]=token}function cachedToken(scope){return Promise.resolve().then(function(){var cached=CACHED_TOKENS[scope];if(cached){if(!expired(cached)){return cached.access_token}delete CACHED_TOKENS[scope]}throw new Error("No cached token")})}function adjustClockSkew(res){var dateHeader=res.headers&&res.headers.date;if(!dateHeader){return}var serverTime=new Date(dateHeader).getTime();if(serverTime!==serverTime){return}serverTime=serverTime/1e3|0;var currentTime=module.exports._clock();CLOCK_SKEW=serverTime-currentTime}function requestToken(scope){return new Promise(function(resolve,reject){request.post(TOKEN_ROUTE).type("form").send({scope:scope}).use(xsrfToken).end(function(err,res){if(err){return reject(err)}adjustClockSkew(res);resolve(res.body)})})}function requestTokenDeduped(scope){if(!IN_FLIGHT_REQUESTS[scope]){IN_FLIGHT_REQUESTS[scope]=requestToken(scope).then(function(token){delete IN_FLIGHT_REQUESTS[scope];return token}).catch(function(e){delete IN_FLIGHT_REQUESTS[scope];throw e})}return IN_FLIGHT_REQUESTS[scope]}module.exports=function getLocalJwt(scope){return Promise.resolve().then(function(){scope=scope||DEFAULT_SCOPE;var cached=cachedToken.bind(null,scope);return cached().catch(function(){return requestTokenDeduped(scope).then(cacheToken.bind(null,scope)).then(cached)})})};function sessionListener(e){switch(e.key){case"Session.Expired":case"Session.UserId":resetCaches();break;default:break}}if(global.addEventListener){global.addEventListener("storage",sessionListener)}else if(global.attachEvent){global.attachEvent("onstorage",sessionListener)}module.exports._clock=clock;module.exports._resetCaches=resetCaches}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"frau-superagent-xsrf-token":4,lie:23,superagent:25}],34:[function(require,module,exports){"use strict";module.exports="frau-jwt-new-jwt"},{}]},{},[1]);
